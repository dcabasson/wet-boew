/*!
 * Web Experience Toolkit (WET) / Boîte à outils de l'expérience Web (BOEW)
 * www.tbs.gc.ca/ws-nw/wet-boew/terms / www.sct.gc.ca/ws-nw/wet-boew/conditions
 */
(function(a){a.fn.datalist=function(){return a(this).each(function(e){var f=a(this),i=a("#"+f.attr("list")),d,j,c=[],g,h,b;g=function(m){var k=m.toLowerCase(),l=j.filter(function(){var o=a(this),n=o.find("span.al-value").html();if(n.length===0){n=o.find("span.al-label").html()}return(k.length===0||n.toLowerCase().indexOf(k)===0)});j.not(l).addClass("al-hide").attr("aria-hidden","true");l.removeClass("al-hide").attr("aria-hidden","false");if(l.length!==0){d.removeClass("al-hide").attr("aria-hidden","false");f.attr("aria-expanded","true")}else{d.addClass("al-hide").attr("aria-hidden","true");f.attr("aria-expanded","false")}};h=function(){d.css("width",f.innerWidth());if(pe.ie>0&&pe.ie<8){d.css("top",f.innerHeight()+13)}};pe.resize(h);i.find("option").each(function(n){var m=a(this),l=m.attr("value"),k=m.attr("label");if(l==="undefined"){l=m.text()}c.push('<li class="al-hide al-option" aria-hidden="true" id="al-option-'+e+"-"+n+'"><a href="javascript:;"><span class="al-value">'+(l!=="undefined"?l:"")+'</span><span class="al-label">'+(k!=="undefined"?k:"")+"</span></a></li>")});f.attr({role:"combobox","aria-expanded":"false","aria-autocomplete":"list","aria-owns":"wb-autolist-"+e}).wrap('<div class="wb-al-container"/>');d=a('<ul role="listbox" id="wb-autolist-'+e+'" class="wb-autolist al-hide" aria-hidden="true">'+c.join("")+"</ul>");j=d.find("li");f.after(d);h();f.on("keyup keydown click vclick",function(o){var m=o.type,k=o.keyCode,n=o.target,l;if(m==="keyup"){if(!(o.ctrlKey||o.altKey||o.metaKey)){if((k>47&&k<58)||(k>64&&k<91)||k===32||k===8){g(f.val())}}}else{if(m==="keydown"){if(!(o.ctrlKey||o.metaKey)){if(!o.altKey&&f.attr("aria-expanded")==="true"){if(k===9||k===27){g("~!!@@#$");f.removeAttr("aria-activedescendent");if(k===27){return false}}else{if(k===38||k===40){visible_options=j.filter(":not(.al-hide)").find("a");if(visible_options.length>0){e=visible_options.index(n);if(k===38){l=visible_options.last()}else{l=visible_options.eq(0)}pe.focus(l);f.attr("aria-activedescendent",l.attr("id"))}return false}}}else{if(k===38||k===40){g("");return false}}}}else{if(m==="click"||m==="vclick"){if(!d.hasClass("al-hide")){g("~!!@@#$")}else{g("")}return false}}}});d.on("keyup keydown click vclick","li, span",function(n){var q=n.type,p=n.keyCode,o=a(n.target),k,m,s,l=f.val(),r;if(q==="keyup"){if(!(n.ctrlKey||n.altKey||n.metaKey)){if((p>47&&p<58)||(p>64&&p<91)||p===32){f.val(l+String.fromCharCode(p));pe.focus(f);g(f.val())}else{if(p===8){if(f.val().length>0){f.val(l.substring(0,l.length-1));g(f.val())}pe.focus(f)}}}}else{if(q==="keydown"){if(!(n.ctrlKey||n.altKey||n.metaKey)){if(p===13){r=o.find("span.al-value").html();if(r.length===0){r=o.find("span.al-label").html()}f.val(r);pe.focus(f);g("~!!@@#$");return false}else{if(p===9||p===27){pe.focus(f);g("~!!@@#$");f.removeAttr("aria-activedescendent");if(p===27){return false}}else{if(p===38||p===40){k=j.filter(":not(.al-hide)").find("a");if(k.length>0){m=k.index(o);if(p===38){s=((m-1)===-1?k.last():k.eq(m-1))}else{s=((m+1)===k.length?k.eq(0):k.eq(m+1))}pe.focus(s);f.attr("aria-activedescendent",s.attr("id"))}return false}}}}}else{if(q==="click"||q==="vclick"){if(!o.hasClass("al-option")){o=o.parent()}r=o.find("span.al-value").html();if(r.length===0){r=o.find("span.al-label").html()}f.val(r);g("~!!@@#$");pe.focus(f)}}}});a(document).on("click touchstart",function(k){if(!d.hasClass("al-hide")&&!a(k.target).is(f)){g("~!!@@#$");f.removeAttr("aria-activedescendent")}})})};a("input[list]").datalist()}(jQuery));